##==================================================================================================
##  TTS - Tiny Test System
##  Copyright 2018 Joel FALCOU
##
##  Licensed under the MIT License <http://opensource.org/licenses/MIT>.
##  SPDX-License-Identifier: MIT
##==================================================================================================
cmake_minimum_required(VERSION 3.2)

##==================================================================================================
## Setup project
##==================================================================================================
project(TTS CXX)
list(APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/cmake")

##==================================================================================================
## Prevent in-source build
##==================================================================================================
if(${PROJECT_SOURCE_DIR} STREQUAL ${PROJECT_BINARY_DIR})
  message( FATAL_ERROR "Building in-source, not recommended! Build in a separate directory." )
endif()

##==================================================================================================
## Compute version string and mode
##==================================================================================================
include(parse_revision)

##==================================================================================================
## Add include directories
##==================================================================================================
include_directories(${PROJECT_SOURCE_DIR}/include)

##==================================================================================================
## Options
##==================================================================================================
option( TTS_BUILD_TEST  "Build tests for tts" ON )
option( TTS_BUILD_DOC   "Build doc for tts"   ON )

##==================================================================================================
## Setup Documentation
##==================================================================================================
if( TTS_BUILD_DOC )
  add_subdirectory(doc)
endif()

##==================================================================================================
## Install target
##==================================================================================================
install ( DIRECTORY ${PROJECT_SOURCE_DIR}/include/tts
          DESTINATION include
        )

##==================================================================================================
## Setup Testing
##==================================================================================================

if( TTS_BUILD_TEST )
  enable_testing()
  add_custom_target(tests)
  add_custom_target(unit)

  enable_testing()
  add_dependencies(tests unit)
  add_subdirectory(test)
endif()
